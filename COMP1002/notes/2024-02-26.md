# Network Layer and IP Addressing

- The role of the network layer; describe communication from one end device to another end device
- Internet Protocol (IP) and it's features for providing connectionless and best effort service
- Basic router configuration
- IPv4 addressing

---

## Network Layer

Provides services to exhange individual pieces of data over the network between identified end devices.

### Processes

Addressing
- Allocating IPv4 address to end user
- Provided addresses must be unique

Encapsulation
- Before transmitting data, a header must be added; this is on top of the header that is passed from the application layer.
- Add src/dst address to each network layer packet

Routing
- Transmit the data from the user to the data centre.
- Provides services to direct the packets to their destination host

Decapsulation
- The receiver will remove the network layer header; the application layer header stays.
- Extract content of the packet at the destination host

### Protocols

IPv4
- $2^{32}$ unique addresses, not enough due to IOT
- RFC791, September 1981
- IPv6, only isolated and ecapsulated in IPv4
- Low overhead, only delivery of packets from source to destination over an interconnected network
- Connectionless
- Best effort delivery; unreliable. No overhead is used to guarantee packet delivery.
- Media independent; operates independently of the medium carrying the data.

IPv6
- $2^{128}$ unique addresses, `340,282,366,920,938,463,463,374,607,431,768,211,456`, 340 undecillion
- Some blocks of this space and some specific addresses are reserved for special uses.

Both are currently supported.

Connectionless Service
- No prior notification of the recipient
- No confirmation of arrival
- No additional control fields in the header
- No control data
- No knowledge of end-to-end delivery

Media Independence
- No strict packet size
- No single transport medium

Best Effort Delivery
- Unreliable
- No capability to recover from loss
- IP has no control fields in the header and no packet tracking

![](https://www.computernetworkingnotes.org/images/ip-tutorials/it07-01-structure-of-ipv4-header.PNG)
> 4 bytes

- IP Source / Destination address (32 bits)
- Time To Live (8 bits)
    - Decrements by at least 1 every time the packet is processed by a router
    - When the value becomes 0, the router drops the packet and it is removed from the network data flow
    - This mechanism prevents routing loops
- Protocol (8 bits)
    - Enables network layer to pass data to the appropriate upper-layer protocol
- Type Of Service (8 bits)
    - Priority
    - To be used by Quality Of Service, QOS
- Fragment Offset (13 bits)
    - Router may fragment a packet when forwarding it from one medium to another medium that has a smaller MTU
    - > Pv4 allows fragmentation which divides the datagram into pieces, each small enough to accommodate a specified MTU limitation. [Maximum Transmission Unit]
    - IPv4 uses Fragment Offset and the MF flag to reconstruct the packet at the destination host.
    - MF: More Fragments Flag (1 bit); MF = 1 -> not the last fragment of a packet, MF = 0 -> last fragment of a packet, reconstruct.
    - DF: Dont Fragment Flag (1 bit); if set, fragmentation is NOT allowed.

### Transport Across Networks

If communication is between hosts in *different* networks, the local network delivers the packet from the source to its *gateway router*.

The router examines the network portion of the destination address and forwards the packet to the appropriate interface.
- If the destination network is directly connected, the packet is forwarded directly to that host.
- If the destination network is not directly connected (indirect), the packet is forwarded to a second router (next-hop router).
- At each hope, the forwarding decisions are based on the information in the IP packet header.

### Routing

- No packet can be forwarded without a route
- A host must either forward a packet to the host on the local network or to the network gateway, as required.
- A router makes a forwarding decision for each packet that arrives at the gateway interface; routing.
- The destination network may be a number of routers (hops) away from the gateway; the route only indicates the next-hop router, not the final router.

Routing: Packet-by-packet and hop-by-hop

Each packet is treated independently in each router along the path.
- Examine the destination IP address and check the routing table for forwarding information.

The router will either:
- Forward the packet to the next-hop router
- Forward the packet to the destination router
- Drop the packet (e.g. TTL expires)

### Routing Table

Network Destination
- Reachable networks

Netmask
- Determine the network and the host portions of the IP address

Gateway
- Address used by the local computer to get to a remote network destination.
- If a destination is *directly* reachable, it will show as "on-link" in this column

Interface
- Address of the physical interface used to send the packet to the gateway that is used to reach the network destination.

Metric
- *Cost* of each route; used to determine the best route to a destination.

Remote routes (from remote networks connected to other router) can either be manuially configured on the local router by the network administrator OR dynamically configured by enabling the local router to exchange routing information with other routers using dynamic routing protocols.

Directly Connected Interfaces
- `C` Directly connected network; automatically created when an interface is configured with an IP address and activated.
- `L` Link local route, automatically created when an interface is configured with an IP address and activated.

Remote Networks
- `S` Route was manually created by an administrator. Static route.
- `D` Route was learned dynamically from another router using the Enhanced Interior Gateway Routing Protocol, EIGRP.
- `O` Route was learned dynamically from another route using the Open Shortest Path First (OSPF) routing protocol.

### Internetworking Operating System, IOS

Internetworking Operating System

### Interfaces

Management Ports
- Console Port
    - Serial Communication
- Auxiliary Port
    - Similar to console, also modem

Network Ports
- LAN
    - Ethernet / Fast Ethernet
- Enhanced high-speed WAN interface card slots
    - Provide modularity and flexibility by enabling the router to support different types of interface modules, including serial, digital subscriber line (DSL), switch port and wireless.